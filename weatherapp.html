<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <!---->
    <form id="zipcode-form">
        <label for="zipcode-input">Enter Your ZipCode:</label>
        <input type="text" id="zipcode-input">
        <br>
        <br>
        <label for="countrycode-input">Enter Your Country Code:</label>
        <input type="text" id="countrycode-input">
        <br>
        <br>
        <input id="find-zipcode" type="submit" value="Zipcode Weather">
    </form>
    <div id="divone">
    </div>
    <div id="divtwo">
    </div>
    <div id="divthree">
    </div>


    <!----------------------->
    <!----------------------->
    <!----------------------->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        //API REQUEST FOR IP DATA
        const APIKeyIP = "f822e5c9d81b944cb089e61702e644de";

        const queryURLIP = "http://api.ipstack.com/check?access_key=" + APIKeyIP;

        $.ajax({
            url: queryURLIP,
            method: "GET"
        })

            .then(function (ipData) {

                console.log(String(ipData.latitude));
                console.log(String(ipData.longitude));

                localStorage.setItem("latitude",String(ipData.latitude));
                localStorage.setItem("longitude",String(ipData.longitude));
                let latitude = localStorage.getItem("latitude");
                let longitude = localStorage.getItem("longitude");

                //API REQUEST FOR WEATHER DATA USING IP
                const APIKeyWeather = "42f33f5100f9cc8bb325c710a41147ec";

                const queryURLWeather = "https://api.openweathermap.org/data/2.5/weather?lat=" + latitude + "&lon=" + longitude +
                    "&units=imperial&appid=" + APIKeyWeather;

                $.ajax({
                    url: queryURLWeather,
                    method: "GET"
                })

                    .then(function (weatherData) {

                        console.log("City: " + weatherData.name);
                        console.log("Temp: " + weatherData.main.temp);
                        console.log("Weather: " + weatherData.weather[0].main);
                    });
            });


        //-----------------------------
        //-----------------------------
        //-----------------------------




        $("#find-zipcode").on("click", function (event) {

            event.preventDefault();


            const zipcode = $("#zipcode-input").val();
            const countrycode = $("#countrycode-input").val();

            //API REQUEST FOR WEATHER DATA USING ZIPCODE
            const APIKeyWeather = "42f33f5100f9cc8bb325c710a41147ec";

            const queryURLWeather = "https://api.openweathermap.org/data/2.5/weather?zip=" + zipcode + "," + countrycode +
                "&units=imperial&appid=" + APIKeyWeather;

            $.ajax({
                url: queryURLWeather,
                method: "GET"
            })

                .then(function (weatherData) {

                    console.log("City: " + weatherData.name);
                    console.log("Temp: " + weatherData.main.temp);
                    console.log("Weather: " + weatherData.weather[0].main);

                    const city = weatherData.name;
                    const temp = weatherData.main.temp;
                    const weather = weatherData.weather[0].main;

                    $("#divone").text(city);
                    $("#divtwo").text(temp);
                    $("#divthree").text(weather);
                });
        });

    </script>

</body>

</html>